<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="preconnect" href="https://www.youtube.com" />
    <title>緑のうたの検索 with LOD</title>
    <link rel="stylesheet" type="text/css" media="screen" href="../asset/Kallem.css" />
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-6KDGBDHBS1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-6KDGBDHBS1');
    </script>
</head>

<body>
    <!-- Load Essential Script -->
    <script src="https://cdn.jsdelivr.net/npm/vue@3.2.33/dist/vue.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <header class="text-black" style="background-color: #5dccab;">
        <div class="container">
            <div class="row g-2 mb-2 pt-2">
                <h1 tabindex="0" class="pt-1 fs-2 col-9 col-md-10 col-lg-10" onclick="location.href='/'">
                    <span style="font-family: Kallem; font-weight: 200;">緑のうたの検索 with LOD</span>
                </h1>
                <div class="col-3 col-md-2 col-lg-2 d-grid my-2">
                    <!--
                    <button type="button" class="btn btn-light py-1" data-bs-toggle="modal"
                        data-bs-target="#aboutModal">
                        About
                    </button>
                    -->
                </div>
            </div>
        </div>
    </header>
    <h2 class="visually-hidden">検索フォーム</h2>
    <article class="container bg-light">
        <form id="inputForm" name="searchConditions" class="row g-2 mb-4">
            <div class="col-12 col-lg-9">
                <div class="form-floating input-group">
                    <input type="text" class="form-control col-8 col-sm-9 col-md-10 col-lg-9" id="keyword"
                        v-bind:value="keyword"></input>
                    <label for="keyword" class="form-label">キーワード</label>
                </div>
            </div>
            <div class="col-12 col-lg-3 py-md-0 col-lg-2 d-grid mb-2 mb-md-0">
                <button type="button" class="btn btn-primary py-2" onclick="searchWithKeyword()">
                    <i class="bi bi-search"></i>検索
                </button>
            </div>
        </form>

        <!-- Loading -->
        <div id="loading" class="invisible col-12 d-flex justify-content-center my-10">
            <div class="spinner-grow text-secondary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>


        </div>


    </article>
    <script>
        // 検索結果（Vue）
        const resListApp = Vue.createApp({
            data() {
                return {
                    items: null,
                    totalResults: null,
                    pages: null,
                    pageMax: null,
                    p: null,
                }
            }
        })
        const inputForm = inputFormApp.mount('#inputForm')

        //メイン検索機能定義
        async function searchWithKeyword(keyword = null, p = 1) {
            //初期化
            document.querySelector("#loading").classList.remove("visually-hidden")
            if (!keyword) {
                keyword = document.querySelector("#keyword").value;
            }
            let query = `PREFIX midori: <https://midori.lv01.biz/>
PREFIX schema: <http://schema.org/>

SELECT DISTINCT ?cover ?work ?canon ?coverTitle ?video ?date WHERE {

?cover schema:additionalType midori:CoverExpression;
schema:recordingOf ?work ;
midori:canonicalExpression ?canon.
?cover rdfs:label ?coverTitle.
?cover schema:video ?video.
?video schema:datePublished ?date.

{{?cover schema:byArtist ?who.} UNION {?canon schema:byArtist ?who.} UNION {?work schema:composer ?who.} UNION {?work schema:lyricist ?who.}
?who schema:name ?name.
FILTER(bif:contains(?name, '"${keyword}"'))
}UNION{
?cover rdfs:label ?keyword.
FILTER(bif:contains(?keyword, '"${keyword}"'))
}UNION{
?cover schema:video ?video.
?video rdfs:label ?keyword.
FILTER(bif:contains(?keyword, '"${keyword}"'))
}

} ORDER BY ?cover`
            let reqUrl = "https://midori.lv01.biz/sparql?default-graph-uri=&query=" + encodeURI(query) + "&format=application%2Fsparql-results%2Bjson"
            console.log(reqUrl)
            
            fetch(reqUrl)
                .then(response => response.json())
                .then(data => {
                    if (data.results.bindings[0]) {
                        cover = data.results.bindings[0].cover.value
                        console.log(cover)
                    }
                })
        }

    </script>

</body>

</html>